{% comment %}
  SWITCH COMPONENT (Shopify Liquid version)
  -----------------------------------------
  Accessible toggle switch similar to Radix UI Switch.

  Usage:
  {% render 'switch', id: 'newsletter-toggle', name: 'subscribe', checked: true %}
{% endcomment %}

{% assign id = id | default: 'switch-' | append: section.id %}
{% assign name = name | default: 'switch' %}
{% assign checked = checked | default: false %}
{% assign class = class | default: '' %}

<style>
  .switch {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    width: 2rem; /* ~32px */
    height: 1.15rem; /* ~18px */
    border-radius: 9999px;
    border: 1px solid transparent;
    background-color: var(--switch-off-bg, rgba(0, 0, 0, 0.1));
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .switch[data-state="checked"] {
    background-color: var(--switch-on-bg, hsl(220, 90%, 56%));
  }

  .switch:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px hsl(220, 90%, 70%, 0.5);
  }

  .switch-thumb {
    position: absolute;
    top: 50%;
    left: 0;
    transform: translate(2px, -50%);
    width: 1rem;
    height: 1rem;
    background-color: var(--switch-thumb-bg, #fff);
    border-radius: 50%;
    transition: transform 0.2s ease, background-color 0.2s ease;
  }

  .switch[data-state="checked"] .switch-thumb {
    transform: translate(calc(100% - 2px), -50%);
    background-color: var(--switch-thumb-checked-bg, #fff);
  }

  .dark .switch {
    background-color: var(--switch-off-bg-dark, rgba(255, 255, 255, 0.25));
  }

  .dark .switch[data-state="checked"] {
    background-color: var(--switch-on-bg-dark, hsl(220, 90%, 60%));
  }

  .switch[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

<div class="switch-wrapper {{ class }}">
  <button
    type="button"
    id="{{ id }}"
    role="switch"
    aria-checked="{{ checked }}"
    aria-disabled="{{ disabled | default: false }}"
    class="switch"
    data-state="{% if checked %}checked{% else %}unchecked{% endif %}"
    onclick="toggleSwitch(this, '{{ name }}')"
  >
    <span class="switch-thumb"></span>
  </button>

  <input
    type="hidden"
    name="{{ name }}"
    value="{% if checked %}true{% else %}false{% endif %}"
  />
</div>

<script>
  function toggleSwitch(el, name) {
    if (el.getAttribute('aria-disabled') === 'true') return;

    const newState = el.dataset.state === 'checked' ? 'unchecked' : 'checked';
    el.dataset.state = newState;
    el.setAttribute('aria-checked', newState === 'checked');

    const hiddenInput = el.parentElement.querySelector(`input[name="${name}"]`);
    if (hiddenInput) hiddenInput.value = newState === 'checked';
  }
</script>
